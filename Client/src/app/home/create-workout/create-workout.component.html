<div class="flex justify-center items-center min-h-screen p-4">
    <div class="text-center bg-dark-blue p-6 rounded-lg max-w-2xl">
        <form class="register-form text-gray-100" #form="ngForm" (ngSubmit)="create()">
            <fieldset>
                <h2 class="text-3xl font-extrabold mb-4 text-gray-100">
                    Create Workout
                </h2>
                <div class="flex flex-row grid-cols-2 mb-6 justify-between items-center">
                    <div class="px-4 w-7/12">
                        <p class="text-left text-sm">Input Workout Name</p>
                        <input
                            class="w-full text-lg bg-transparent border-b-2 border-white border-solid focus:outline-none caret-white"
                            (ngModelChange)="submitName(form)" type="text" name="title" id="title"
                            [(ngModel)]="this.workoutObj.title" placeholder="Morning Workout" />
                    </div>
                    <div class="px-4">
                        <p class="text-sm mb-2">Duration</p>
                            <div 
                                class="text-accent-green underline decoration-dotted cursor-pointer text-lg font-semibold flex items-center gap-1 min-h-[44px] justify-center"
                                (click)="toggleDurationInput()">
                                <span>{{workoutObj.duration | duration}}</span>
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
                                </svg>
                            </div>

                        @if (isEditingDuration) {
                        <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                            <div class="bg-dark-blue p-6 rounded-lg shadow-lg max-w-sm w-full mx-4">
                                <h3 class="text-lg font-semibold text-white mb-4 text-center">Set Duration</h3>

                                <div class="flex gap-4 justify-center mb-4">
                                    <div class="flex flex-col items-center">
                                        <span class="text-xs text-gray-300">Hours</span>
                                        <input type="number" class="w-16 px-2 py-1 text-black rounded text-center"
                                            [(ngModel)]="tempHours" name="tempHours" min="0" max="23" />
                                    </div>

                                    <div class="flex flex-col items-center">
                                        <span class="text-xs text-gray-300">Minutes</span>
                                        <input type="number" class="w-16 px-2 py-1 text-black rounded text-center"
                                            [(ngModel)]="tempMinutes" name="tempMinutes" min="0" max="59"
                                            placeholder="21" />
                                    </div>
                                </div>

                                <div class="flex gap-3 justify-center">
                                    <button type="button"
                                        class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600 transition duration-200"
                                        (click)="saveDuration()">
                                        Save
                                    </button>
                                    <button type="button"
                                        class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition duration-200"
                                        (click)="cancelDurationEdit()">
                                        Cancel
                                    </button>
                                </div>
                            </div>
                        </div>
                        }
                    </div>
                </div>

                @for(exercise of workoutObj.exercises; track $index) {
                <app-create-exercise 
                    [name]="workoutObj.exercises[$index].name" 
                    [last]="$index === workoutObj.exercises.length - 1" 
                    [exercise]="workoutObj.exercises[$index]"
                    [indx]="$index" (setChange)="handleExerciseChange($event, $index)" 
                    [deleteExercise]="deleteExercise"
                    [exerciseSelection]="exerciseSelection"></app-create-exercise>
                }
                <div class="flex flex-col space-y-3">
                    <button 
                        type="button"
                        class="mx-2 bg-gray-700 text-white font-semibold py-3 px-6 rounded-lg border-2 border-accent-green hover:bg-accent-green hover:text-white transform hover:scale-105 transition-all duration-200 ease-in-out shadow-lg flex items-center justify-center gap-2 group"
                        (click)="showExerciseSelection = true"
                        >
                        <svg class="w-5 h-5 group-hover:text-white transition-colors duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                        </svg>
                        Choose Next Exercise
                    </button>

                    <button [disabled]="form.invalid"
                        class="mx-2 h-12 px-6 rounded-lg bg-accent-green text-black font-extrabold shadow-xl border-2 border-accent-green hover:bg-green-500 hover:border-green-500 transform hover:scale-105 transition-all duration-200 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center justify-center gap-2">
                        <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                        END WORKOUT
                    </button>
                </div>
                 @if (showExerciseSelection) {
                <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div class="bg-dark-blue p-6 rounded-lg shadow-lg max-w-md w-full mx-4 max-h-96 overflow-y-auto">
                        <h3 class="text-lg font-semibold text-white mb-4 text-center">Choose Exercise</h3>
                        
                        <div class="space-y-2 mb-4">
                            @for (exercise of exerciseSelection; track exercise.id) {
                            <button 
                                type="button"
                                class="w-full text-left p-3 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition duration-200"
                                (click)="selectExercise(exercise)">
                                {{ exercise.name }}
                            </button>
                            }
                        </div>

                        <div class="flex justify-center">
                            <button type="button"
                                class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600 transition duration-200"
                                (click)="showExerciseSelection = false">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
                }
            </fieldset>
        </form>

        <a class="inline-block mt-4 text-gray-300 font-semibold py-2 px-6 rounded-lg border-2 border-gray-500 hover:border-gray-300 hover:text-white hover:bg-gray-700 transform hover:scale-105 transition-all duration-200 ease-in-out shadow-md"
            routerLink="/">
            ‚Üê Close
        </a>
    </div>
</div>